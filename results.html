<!DOCTYPE html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Virtual Pet ‚Ä¢ Search Results</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Shared Navbar -->
    <header class="navbar">
      <div class="navbar-inner">
        <div class="logo-area">
          <img src="logo11.jpg" alt="Virtual Pet Logo" />
          <div class="logo-text">
            <span>Virtual Pet</span>
            <span>Search</span>
          </div>
        </div>

        <button class="nav-toggle" aria-label="Toggle navigation" id="navToggle">
          ‚ò∞
        </button>

        <nav class="nav-links" id="navLinks">
          <a href="index.html#home">Home</a>
          <a href="index.html#games">Games</a>
          <a href="dog.html">Dog Care</a>
          <a href="cat.html">Cat Care</a>
          <a href="index.html#about">About</a>
        </nav>

        <div class="nav-right">
          <div class="nav-search" id="navSearch">
            <input
              type="text"
              id="search"
              placeholder="Search for a pet‚Ä¶"
              autocomplete="off"
            />
            <button type="button" onclick="searchPet()">
              üîç <span>Search</span>
            </button>
          </div>

          <button class="theme-toggle" type="button" id="themeToggle">
            <span id="themeIcon">üåô</span>
            <span>Theme</span>
          </button>
        </div>
      </div>
    </header>

    <main class="main">
      <div class="container">
        <h1 class="results-heading">Search results</h1>
        <p class="results-subtitle" id="resultsInfo">
          Looking up pets matching your search‚Ä¶
        </p>

        <div id="results" class="results-grid"></div>
      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        <span>¬© 2025 Virtual Pet. All rights reserved.</span>
        <span>Search powered by your backend API.</span>
      </div>
    </footer>

    <script>
      const htmlEl = document.documentElement;
      const themeToggle = document.getElementById("themeToggle");
      const themeIcon = document.getElementById("themeIcon");

      function setTheme(theme) {
        htmlEl.setAttribute("data-theme", theme);
        themeIcon.textContent = theme === "dark" ? "üåô" : "‚òÄÔ∏è";
        localStorage.setItem("vp-theme", theme);
      }

      const storedTheme = localStorage.getItem("vp-theme");
      if (storedTheme) setTheme(storedTheme);

      themeToggle.addEventListener("click", () => {
        const current = htmlEl.getAttribute("data-theme") || "dark";
        setTheme(current === "dark" ? "light" : "dark");
      });

      const navToggle = document.getElementById("navToggle");
      const navLinks = document.getElementById("navLinks");
      const navSearch = document.getElementById("navSearch");

      navToggle.addEventListener("click", () => {
        navLinks.classList.toggle("open");
        navSearch.classList.toggle("open");
      });

      function searchPet() {
        const qFromInput = document.getElementById("search").value.trim();
        if (!qFromInput) return;
        window.location.href = `results.html?q=${encodeURIComponent(qFromInput)}`;
      }
      window.searchPet = searchPet;

      // Get search query from URL
      const urlParams = new URLSearchParams(window.location.search);
      const query = urlParams.get("q") || "";
      const resultsDiv = document.getElementById("results");
      const resultsInfo = document.getElementById("resultsInfo");

      if (query) {
        document.getElementById("search").value = query;
        resultsInfo.textContent = `Showing results for ‚Äú${query}‚Äù`;
      } else {
        resultsInfo.textContent =
          "Type something in the search box and press Search.";
      }

      // Fetch from backend (same as your original, just styled)
      if (query) {
        fetch(`http://localhost:5000/search?q=${encodeURIComponent(query)}`)
          .then((response) => {
            if (!response.ok) {
              throw new Error("Network response was not ok");
            }
            return response.json();
          })
          .then((data) => {
            resultsDiv.innerHTML = "";

            if (!Array.isArray(data) || data.length === 0) {
              resultsDiv.innerHTML =
                '<p class="card-text">No results found for your search.</p>';
              return;
            }

            data.forEach((pet) => {
              const card = document.createElement("article");
              card.className = "result-card reveal";

              const imgHtml = pet.image
                ? `<img src="${pet.image}" alt="${pet.breed}" />`
                : "";

              card.innerHTML = `
                ${imgHtml}
                <h3 class="card-title">${pet.breed}</h3>
                <p class="card-text"><strong>Description:</strong> ${
                  pet.description || ""
                }</p>
                <p class="result-meta"><strong>Foods they like:</strong> ${
                  (pet.foods_likes || []).join(", ") || "N/A"
                }</p>
                <p class="result-meta"><strong>Foods they don't like:</strong> ${
                  (pet.foods_dislikes || []).join(", ") || "N/A"
                }</p>
                <p class="result-meta"><strong>Activities they enjoy:</strong> ${
                  (pet.activities || []).join(", ") || "N/A"
                }</p>
              `;

              resultsDiv.appendChild(card);
            });

            // trigger reveal animation
            const revealEls = document.querySelectorAll(".reveal");
            const observer = new IntersectionObserver(
              (entries) => {
                entries.forEach((entry) => {
                  if (entry.isIntersecting) {
                    entry.target.classList.add("reveal-visible");
                    observer.unobserve(entry.target);
                  }
                });
              },
              { threshold: 0.15 }
            );
            revealEls.forEach((el) => observer.observe(el));
          })
          .catch((error) => {
            console.error("Error fetching data:", error);
            resultsDiv.innerHTML =
              '<p class="card-text">Error fetching results. Please ensure your backend is running.</p>';
          });
      }
    </script>
  </body>
</html>
